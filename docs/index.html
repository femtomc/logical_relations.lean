<!DOCTYPE html>
<html class="alectryon-standalone"><head><title>IntroLogicalRelations.lean</title><meta charset="utf-8"><meta content="Alectryon" name="generator"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="alectryon.css" rel="stylesheet"><link href="pygments.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" /><script src="alectryon.js"></script></head><body><article class="alectryon-root alectryon-centered"><div class="alectryon-banner">Built with <a href="https://github.com/cpitclaudel/alectryon/">Alectryon</a>, running Lean4 v4.0.0-nightly-2023-08-19. Bubbles (<span class="alectryon-bubble"></span>) indicate interactive fragments: hover for details, tap to reveal contents. Use <kbd>Ctrl+↑</kbd> <kbd>Ctrl+↓</kbd> to navigate, <kbd>Ctrl+🖱️</kbd> to focus. On Mac, use <kbd>⌘</kbd> instead of <kbd>Ctrl</kbd>.<br>Hover-Settings: Show types:<input id="toggleswitch" type="checkbox" onClick="toggleShowTypes(this);"> Show goals:<input id="toggleswitch" type="checkbox" onClick="toggleShowGoals(this);" checked><br></div><pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="alectryon-token">
<span class="c">/-</span><span class="cm">!</span>
<span class="cm">This is a tutorial file showing the usage of logical relations to prove properties about languages, including things like soundness of a type system, and even soundness of a denotational semantics.</span>

<span class="cm">First, we&#39;ll start by considering a simple language with arithmetic, and function definitions.</span>
<span class="cm">-/</span>

<span class="kd">inductive</span> Term
<span class="bp">|</span> Nat : ℕ <span class="bp">→</span> Term
<span class="bp">|</span> Var : ℕ <span class="bp">→</span> Term
<span class="bp">|</span> Prim : (ℕ <span class="bp">→</span> ℕ <span class="bp">→</span> ℕ) <span class="bp">→</span> Term
<span class="bp">|</span> Abs : Term <span class="bp">→</span> Term
<span class="bp">|</span> App : Term <span class="bp">→</span> Term <span class="bp">→</span> Term

<span class="kd">def</span> termRepr : Term <span class="bp">→</span> Nat <span class="bp">→</span> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="IntroLogicalRelations-lean-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="IntroLogicalRelations-lean-chk0"><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Lean.Format</var><b>: </b><span>Type u_4</span></span></div></blockquote></div></small></div>Lean.Format</span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Error: unknown identifier <span class="bp">&#39;</span>Lean.Format&#39;</blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token">
<span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Nat</var><b>: </b><span>{ℕ : Sort ?u.1464} → ℕ → Term</span></span></div></blockquote></div></small></div>Term.Nat</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>ℕ✝</span></span></div></blockquote></div></small></div><span class="nv">n</span></span><span class="alectryon-token">, _ <span class="bp">=&gt;</span> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="IntroLogicalRelations-lean-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="IntroLogicalRelations-lean-chk1"><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>repr</var><b>: </b><span>{α : Type u_1} → [inst : Repr α] → α → Std.Format</span></span></div></blockquote></div></small></div>repr</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>ℕ✝</span></span></div></blockquote></div></small></div><span class="nv">n</span></span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Error: failed to synthesize <span class="kd">instance</span>
  Repr ℕ<span class="bp">✝</span></blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token">
<span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Var</var><b>: </b><span>{ℕ : Sort ?u.1519} → ℕ → Term</span></span></div></blockquote></div></small></div>Term.Var</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>ℕ✝</span></span></div></blockquote></div></small></div><span class="nv">n</span></span><span class="alectryon-token">, _ <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>&quot;var(&quot;</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="s2">&quot;var(&quot;</span></span><span class="alectryon-token"> <span class="bp">++</span> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="IntroLogicalRelations-lean-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="IntroLogicalRelations-lean-chk2"><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>repr</var><b>: </b><span>{α : Type u_2} → [inst : Repr α] → α → Std.Format</span></span></div></blockquote></div></small></div>repr</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>ℕ✝</span></span></div></blockquote></div></small></div><span class="nv">n</span></span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Error: failed to synthesize <span class="kd">instance</span>
  Repr ℕ<span class="bp">✝</span></blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token"> <span class="bp">++</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>&quot;)&quot;</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="s2">&quot;)&quot;</span></span><span class="alectryon-token">
<span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Prim</var><b>: </b><span>{ℕ : Sort ?u.1812} → (ℕ → ℕ → ℕ) → Term</span></span></div></blockquote></div></small></div>Term.Prim</span><span class="alectryon-token"> _, _ <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>&quot;&lt;opaque prim&gt;&quot;</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="s2">&quot;&lt;opaque prim&gt;&quot;</span></span><span class="alectryon-token">
<span class="bp">|</span> Term.Abs t, depth <span class="bp">=&gt;</span> <span class="s2">&quot;(λ &quot;</span> <span class="bp">++</span> termRepr t (depth <span class="bp">+</span> <span class="mi">1</span>) <span class="bp">++</span> <span class="s2">&quot;)&quot;</span>
<span class="bp">|</span> Term.App t1 t2, depth <span class="bp">=&gt;</span> <span class="s2">&quot;(&quot;</span> <span class="bp">++</span> termRepr t1 (depth <span class="bp">+</span> <span class="mi">1</span>) <span class="bp">++</span> <span class="s2">&quot; &quot;</span> <span class="bp">++</span> termRepr t2 (depth <span class="bp">+</span> <span class="mi">1</span>) <span class="bp">++</span> <span class="s2">&quot;)&quot;</span>

</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="IntroLogicalRelations-lean-chk3" style="display: none" type="checkbox"><label class="alectryon-input" for="IntroLogicalRelations-lean-chk3"><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>instance</var><b>: </b><span>Repr Term</span></span></div></blockquote></div></small></div><span class="kd">instance</span></span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Warning: declaration uses <span class="bp">&#39;</span><span class="gr">sorry</span><span class="bp">&#39;</span></blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Repr</var><b>: </b><span>Type (max (max u_1 (u_2 + 1)) (u_3 + 1)) → Type (max (max u_1 (u_2 + 1)) (u_3 + 1))</span></span></div></blockquote></div></small></div>Repr</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Type (max (max (u_3 + 1) (u_2 + 1)) u_1)</span></span></div></blockquote></div></small></div>Term</span><span class="alectryon-token"> </span><span class="alectryon-token"><span class="k">where</span></span><span class="alectryon-token">
reprPrec </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">t</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>_</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div>_</span><span class="alectryon-token"> := </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>termRepr</var><b>: </b><span>Term → Nat → sorryAx (Type ?u.2089) true</span></span></div></blockquote></div></small></div>termRepr</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">t</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>0</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">0</span></span><span class="alectryon-token">

</span><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Env</var><b>: </b><span>Type (max (max u_1 u_2) u_3)</span></span></div></blockquote></div></small></div><span class="nv">Env</span></span><span class="alectryon-token"> := </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>List</var><b>: </b><span>Type (max (max u_1 u_2) u_3) → Type (max (max u_1 u_2) u_3)</span></span></div></blockquote></div></small></div>List</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Type (max (max u_3 u_2) u_1)</span></span></div></blockquote></div></small></div>Term</span><span class="alectryon-token">

</span><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lookupEnv</var><b>: </b><span>{ℕ : Sort u_1} → Env → ℕ → Option Term</span></span></div></blockquote></div></small></div><span class="nv">lookupEnv</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Env</var><b>: </b><span>Type (max (max u_2 u_3) u_4)</span></span></div></blockquote></div></small></div>Env</span><span class="alectryon-token"> <span class="bp">-&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ℕ</var><b>: </b><span>Sort u_1</span></span></div></blockquote></div></small></div><span class="nv">ℕ</span></span><span class="alectryon-token"> <span class="bp">-&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Option</var><b>: </b><span>Type (max (max u_5 u_6) u_7) → Type (max (max u_5 u_6) u_7)</span></span></div></blockquote></div></small></div>Option</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Type (max (max u_7 u_6) u_5)</span></span></div></blockquote></div></small></div>Term</span><span class="alectryon-token">
<span class="bp">|</span> [], _ <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>none</var><b>: </b><span>{α : Type (max (max u_5 u_6) u_7)} → Option α</span></span></div></blockquote></div></small></div>none</span><span class="alectryon-token">
<span class="bp">|</span> (v :: _), </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="IntroLogicalRelations-lean-chk4" style="display: none" type="checkbox"><label class="alectryon-input" for="IntroLogicalRelations-lean-chk4"><span class="alectryon-token"><span class="mi">0</span></span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Error: failed to synthesize <span class="kd">instance</span>
  OfNat ℕ <span class="mi">0</span></blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token"> <span class="bp">=&gt;</span> some v
<span class="bp">|</span> (_ :: vs), (n <span class="bp">+</span> <span class="mi">1</span>) <span class="bp">=&gt;</span> lookupEnv vs n

</span><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>shift</var><b>: </b><span>{ℕ : Type u_1} → ℕ → Term → Term</span></span></div></blockquote></div></small></div><span class="nv">shift</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ℕ</var><b>: </b><span>Type u_1</span></span></div></blockquote></div></small></div><span class="nv">ℕ</span></span><span class="alectryon-token"> <span class="bp">-&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Type (max (max u_2 (u_3 + 1)) u_4)</span></span></div></blockquote></div></small></div>Term</span><span class="alectryon-token"> <span class="bp">-&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Type (max (max u_2 u_5) u_4)</span></span></div></blockquote></div></small></div>Term</span><span class="alectryon-token">
<span class="bp">|</span> _, </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Nat</var><b>: </b><span>{ℕ : Sort ?u.2406} → ℕ → Term</span></span></div></blockquote></div></small></div>Term.Nat</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>ℕ✝</span></span></div></blockquote></div></small></div><span class="nv">n</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Nat</var><b>: </b><span>{ℕ : Sort u_2} → ℕ → Term</span></span></div></blockquote></div></small></div>Term.Nat</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>ℕ✝</span></span></div></blockquote></div></small></div><span class="nv">n</span></span><span class="alectryon-token">
<span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>d</var><b>: </b><span>ℕ</span></span></div></blockquote></div></small></div><span class="nv">d</span></span><span class="alectryon-token">, </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Var</var><b>: </b><span>{ℕ : Sort ?u.2437} → ℕ → Term</span></span></div></blockquote></div></small></div>Term.Var</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>k</var><b>: </b><span>ℕ✝</span></span></div></blockquote></div></small></div><span class="nv">k</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Var</var><b>: </b><span>{ℕ : Sort u_5} → ℕ → Term</span></span></div></blockquote></div></small></div>Term.Var</span><span class="alectryon-token"> (</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="IntroLogicalRelations-lean-chk5" style="display: none" type="checkbox"><label class="alectryon-input" for="IntroLogicalRelations-lean-chk5"><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>k + d</var><b>: </b><span>?m.3153 d ℕ✝ k</span></span></div></blockquote></div></small></div>k <span class="bp">+</span> d</span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Error: failed to synthesize <span class="kd">instance</span>
  HAdd ℕ<span class="bp">✝</span> ℕ <span class="bp">?</span>m.2699</blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token">)
<span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>d</var><b>: </b><span>ℕ</span></span></div></blockquote></div></small></div><span class="nv">d</span></span><span class="alectryon-token">, </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Abs</var><b>: </b><span>Term → Term</span></span></div></blockquote></div></small></div>Term.Abs</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">t</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Abs</var><b>: </b><span>Term → Term</span></span></div></blockquote></div></small></div>Term.Abs</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>shift</var><b>: </b><span>{ℕ : Type u_1} → ℕ → Term → Term</span></span></div></blockquote></div></small></div><span class="nv">shift</span></span><span class="alectryon-token"> (</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="IntroLogicalRelations-lean-chk6" style="display: none" type="checkbox"><label class="alectryon-input" for="IntroLogicalRelations-lean-chk6"><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>d</var><b>: </b><span>ℕ</span></span></div></blockquote></div></small></div><span class="nv">d</span></span><span class="alectryon-token"> <span class="bp">+</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>1</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">1</span></span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Error: failed to synthesize <span class="kd">instance</span>
  HAdd ℕ Nat (<span class="bp">?</span>m.2780 d t)</blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token">) </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">t</span></span><span class="alectryon-token">)
<span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>d</var><b>: </b><span>ℕ</span></span></div></blockquote></div></small></div><span class="nv">d</span></span><span class="alectryon-token">, </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.App</var><b>: </b><span>Term → Term → Term</span></span></div></blockquote></div></small></div>Term.App</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t1</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">t1</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t2</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">t2</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.App</var><b>: </b><span>Term → Term → Term</span></span></div></blockquote></div></small></div>Term.App</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>shift</var><b>: </b><span>{ℕ : Type u_1} → ℕ → Term → Term</span></span></div></blockquote></div></small></div><span class="nv">shift</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>d</var><b>: </b><span>ℕ</span></span></div></blockquote></div></small></div><span class="nv">d</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t1</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">t1</span></span><span class="alectryon-token">) (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>shift</var><b>: </b><span>{ℕ : Type u_1} → ℕ → Term → Term</span></span></div></blockquote></div></small></div><span class="nv">shift</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>d</var><b>: </b><span>ℕ</span></span></div></blockquote></div></small></div><span class="nv">d</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t2</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">t2</span></span><span class="alectryon-token">)
<span class="bp">|</span> _, </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Prim</var><b>: </b><span>{ℕ : Sort ?u.2820} → (ℕ → ℕ → ℕ) → Term</span></span></div></blockquote></div></small></div>Term.Prim</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>ℕ✝ → ℕ✝ → ℕ✝</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Prim</var><b>: </b><span>{ℕ : Sort u_4} → (ℕ → ℕ → ℕ) → Term</span></span></div></blockquote></div></small></div>Term.Prim</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>ℕ✝ → ℕ✝ → ℕ✝</span></span></div></blockquote></div></small></div><span class="nv">f</span></span><span class="alectryon-token">

</span><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>subst</var><b>: </b><span>{ℕ : Type u_1} → ℕ → Term → Term → Term</span></span></div></blockquote></div></small></div><span class="nv">subst</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ℕ</var><b>: </b><span>Type u_1</span></span></div></blockquote></div></small></div><span class="nv">ℕ</span></span><span class="alectryon-token"> <span class="bp">-&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Type (max (max u_2 (u_3 + 1)) u_4)</span></span></div></blockquote></div></small></div>Term</span><span class="alectryon-token"> <span class="bp">-&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Type (max (max u_2 (u_3 + 1)) u_4)</span></span></div></blockquote></div></small></div>Term</span><span class="alectryon-token"> <span class="bp">-&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Type (max (max u_2 (u_3 + 1)) u_4)</span></span></div></blockquote></div></small></div>Term</span><span class="alectryon-token">
<span class="bp">|</span> _, _, </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Nat</var><b>: </b><span>{ℕ : Sort ?u.3230} → ℕ → Term</span></span></div></blockquote></div></small></div>Term.Nat</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>ℕ✝</span></span></div></blockquote></div></small></div><span class="nv">n</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Nat</var><b>: </b><span>{ℕ : Sort u_2} → ℕ → Term</span></span></div></blockquote></div></small></div>Term.Nat</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>ℕ✝</span></span></div></blockquote></div></small></div><span class="nv">n</span></span><span class="alectryon-token">
<span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>k</var><b>: </b><span>ℕ</span></span></div></blockquote></div></small></div><span class="nv">k</span></span><span class="alectryon-token">, </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>s</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">s</span></span><span class="alectryon-token">, </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">t</span></span><span class="alectryon-token"><span class="bp">@</span>(</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Var</var><b>: </b><span>{ℕ : Sort ?u.3268} → ℕ → Term</span></span></div></blockquote></div></small></div>Term.Var</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>k'</var><b>: </b><span>ℕ✝</span></span></div></blockquote></div></small></div><span class="nv">k&#39;</span></span><span class="alectryon-token">) <span class="bp">=&gt;</span> </span><span class="alectryon-token"><span class="k">if</span></span><span class="alectryon-token"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="IntroLogicalRelations-lean-chk7" style="display: none" type="checkbox"><label class="alectryon-input" for="IntroLogicalRelations-lean-chk7"><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>k</var><b>: </b><span>ℕ</span></span></div></blockquote></div></small></div><span class="nv">k</span></span><span class="alectryon-token"> <span class="bp">=</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>k'</var><b>: </b><span>ℕ✝</span></span></div></blockquote></div></small></div><span class="nv">k&#39;</span></span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Error: type mismatch
  k&#39;
has type
  ℕ<span class="bp">✝</span> : <span class="kt">Sort</span> <span class="bp">?</span>u.3281
but is expected to <span class="k">have</span> type
  ℕ : <span class="kt">Sort</span> <span class="bp">?</span>u.3202</blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token"> </span><span class="alectryon-token"><span class="k">then</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>s</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">s</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><span class="k">else</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">t</span></span><span class="alectryon-token">
<span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>k</var><b>: </b><span>ℕ</span></span></div></blockquote></div></small></div><span class="nv">k</span></span><span class="alectryon-token">, </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>s</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">s</span></span><span class="alectryon-token">, </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Abs</var><b>: </b><span>Term → Term</span></span></div></blockquote></div></small></div>Term.Abs</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">t</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Abs</var><b>: </b><span>Term → Term</span></span></div></blockquote></div></small></div>Term.Abs</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>subst</var><b>: </b><span>{ℕ : Type u_1} → ℕ → Term → Term → Term</span></span></div></blockquote></div></small></div><span class="nv">subst</span></span><span class="alectryon-token"> (</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="IntroLogicalRelations-lean-chk8" style="display: none" type="checkbox"><label class="alectryon-input" for="IntroLogicalRelations-lean-chk8"><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>k</var><b>: </b><span>ℕ</span></span></div></blockquote></div></small></div><span class="nv">k</span></span><span class="alectryon-token"> <span class="bp">+</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>1</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">1</span></span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Error: failed to synthesize <span class="kd">instance</span>
  HAdd ℕ Nat (<span class="bp">?</span>m.3730 k s t)</blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token">) (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>shift</var><b>: </b><span>{ℕ : Type} → ℕ → Term → Term</span></span></div></blockquote></div></small></div>shift</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>1</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">1</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>s</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">s</span></span><span class="alectryon-token">) </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">t</span></span><span class="alectryon-token">)
<span class="bp">|</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>k</var><b>: </b><span>ℕ</span></span></div></blockquote></div></small></div><span class="nv">k</span></span><span class="alectryon-token">, </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>s</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">s</span></span><span class="alectryon-token">, </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.App</var><b>: </b><span>Term → Term → Term</span></span></div></blockquote></div></small></div>Term.App</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t1</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">t1</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t2</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">t2</span></span><span class="alectryon-token"> <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.App</var><b>: </b><span>Term → Term → Term</span></span></div></blockquote></div></small></div>Term.App</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>subst</var><b>: </b><span>{ℕ : Type u_1} → ℕ → Term → Term → Term</span></span></div></blockquote></div></small></div><span class="nv">subst</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>k</var><b>: </b><span>ℕ</span></span></div></blockquote></div></small></div><span class="nv">k</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>s</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">s</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t1</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">t1</span></span><span class="alectryon-token">) (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>subst</var><b>: </b><span>{ℕ : Type u_1} → ℕ → Term → Term → Term</span></span></div></blockquote></div></small></div><span class="nv">subst</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>k</var><b>: </b><span>ℕ</span></span></div></blockquote></div></small></div><span class="nv">k</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>s</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">s</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t2</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">t2</span></span><span class="alectryon-token">)
<span class="bp">|</span> _, _, </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">t</span></span><span class="alectryon-token"><span class="bp">@</span>(</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Prim</var><b>: </b><span>{ℕ : Sort ?u.3781} → (ℕ → ℕ → ℕ) → Term</span></span></div></blockquote></div></small></div>Term.Prim</span><span class="alectryon-token"> _) <span class="bp">=&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t</var><b>: </b><span>Term</span></span></div></blockquote></div></small></div><span class="nv">t</span></span><span class="alectryon-token">

</span><span class="alectryon-token"><span class="kd">def</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>eval</var><b>: </b><span>{ℕ : Sort u_1} → ℕ → Env → Term → Term</span></span></div></blockquote></div></small></div><span class="nv">eval</span></span><span class="alectryon-token"> : </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ℕ</var><b>: </b><span>Sort u_1</span></span></div></blockquote></div></small></div><span class="nv">ℕ</span></span><span class="alectryon-token"> <span class="bp">-&gt;</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Env</var><b>: </b><span>Type (max (max u_2 u_3) u_4)</span></span></div></blockquote></div></small></div>Env</span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Type (max (max u_5 u_6) u_7)</span></span></div></blockquote></div></small></div>Term</span><span class="alectryon-token"> <span class="bp">→</span> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Type (max (max u_8 u_9) u_10)</span></span></div></blockquote></div></small></div>Term</span><span class="alectryon-token">
<span class="bp">|</span> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="IntroLogicalRelations-lean-chk9" style="display: none" type="checkbox"><label class="alectryon-input" for="IntroLogicalRelations-lean-chk9"><span class="alectryon-token"><span class="mi">0</span></span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Error: failed to synthesize <span class="kd">instance</span>
  OfNat ℕ <span class="mi">0</span></blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token">, _, t<span class="bp">@</span>(_) <span class="bp">=&gt;</span> t
<span class="bp">|</span> _, _, Term.Nat n <span class="bp">=&gt;</span> Term.Nat n
<span class="bp">|</span> _, env, Term.Var n <span class="bp">=&gt;</span> (lookupEnv env n)<span class="bp">.</span></span><span class="alectryon-token"><span class="na">getD</span></span><span class="alectryon-token"> (Term.Var n)
<span class="bp">|</span> fuel <span class="bp">+</span> <span class="mi">1</span>, env, Term.Abs t <span class="bp">=&gt;</span> Term.Abs (eval fuel (Term.Var <span class="mi">0</span> :: env.map (shift <span class="mi">1</span>)) t)
<span class="bp">|</span> _, _, Term.Prim f <span class="bp">=&gt;</span> Term.Prim f
<span class="bp">|</span> fuel <span class="bp">+</span> <span class="mi">1</span>, env, (Term.App (Term.Abs t) v) <span class="bp">=&gt;</span>
  </span><span class="alectryon-token"><span class="k">let</span></span><span class="alectryon-token"> v_eval := eval fuel env v<span class="bp">;</span> 
  eval fuel env (subst <span class="mi">0</span> v_eval t) 
<span class="bp">|</span> fuel <span class="bp">+</span> <span class="mi">1</span>, env, (Term.App t1 t2) <span class="bp">=&gt;</span>
  </span><span class="alectryon-token"><span class="k">let</span></span><span class="alectryon-token"> t1_eval := eval fuel env t1<span class="bp">;</span>
  </span><span class="alectryon-token"><span class="k">let</span></span><span class="alectryon-token"> t2_eval := eval fuel env t2<span class="bp">;</span>
  eval fuel env (Term.App t1_eval t2_eval)

</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="IntroLogicalRelations-lean-chka" style="display: none" type="checkbox"><label class="alectryon-input" for="IntroLogicalRelations-lean-chka"><span class="alectryon-token"><span class="k">#eval</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>eval</var><b>: </b><span>{ℕ : Type} → ℕ → Env → Term → Term</span></span></div></blockquote></div></small></div>eval</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>10</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">10</span></span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>[]</var><b>: </b><span>List Term</span></span></div></blockquote></div></small></div>[]</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.App</var><b>: </b><span>Term → Term → Term</span></span></div></blockquote></div></small></div>Term.App</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Abs</var><b>: </b><span>Term → Term</span></span></div></blockquote></div></small></div>Term.Abs</span><span class="alectryon-token"> (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Var</var><b>: </b><span>{ℕ : Type} → ℕ → Term</span></span></div></blockquote></div></small></div>Term.Var</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>0</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">0</span></span><span class="alectryon-token">)) (</span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term.Nat</var><b>: </b><span>{ℕ : Type} → ℕ → Term</span></span></div></blockquote></div></small></div>Term.Nat</span><span class="alectryon-token"> </span><span class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>5</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">5</span></span><span class="alectryon-token">))</span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Error: cannot evaluate code because <span class="bp">&#39;</span>Lean.runEval._at._eval._spec_1._lambda_1&#39; uses <span class="bp">&#39;</span><span class="gr">sorry</span><span class="bp">&#39;</span> and<span class="bp">/</span>or contains errors</blockquote></div></div></small></span><span class="alectryon-wsp"><span class="alectryon-token">
</span></span></pre></article></body></html>